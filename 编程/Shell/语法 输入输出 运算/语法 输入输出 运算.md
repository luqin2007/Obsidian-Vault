# 从这里开始，起飞了

bash 语句不需要行末 `;`，同一行多条语句使用 `;` 分割

一条命令写在多行，在每行结尾使用 `\` 标记
# 注释

脚本第一行使用 `shebang` 符号 `#!` 指定脚本解释器，后面的代码将用指定的解释器运行

```shell
#!/bin/bash
```

使用 `#` 和 `<<` 开头表示单行和多行注释
- 单行注释：直接在 `#` 后使用
- 多行注释：单独一行 `<<标记` 开始，单独一行 `标记` 结束，中间的都是注释，收尾标记相同

```shell
# 单行注释
<<COMMENT
多行注释
注释行1
注释行2
...
注释行N
COMMENT
```
# 执行

脚本文件没有 x 权限时，使用解释器运行即可

```shell
$> bash example.sh
```

脚本文件有执行权限时，可以直接运行

```shell
$> chmod +x ./example.sh
$> ./example.sh
```

使用 `pstree` 可以看到，以上两种方法终端都会创建一个新的子线程执行脚本。使用 `source` 或 `.` 在当前终端线程执行脚本

```shell
$> source example.sh
$> . example.sh
```
# 输入输出

## 输出

- [[echo]]

![[echo]]

- printf：类似 C/C++ 的 `printf` 函数，通过占位符输出，本身支持转义符，支持 `\e` 设置文本格式

![[../../../../_resources/images/Pasted image 20241116022026.png]]
## 输入

![[read]]

## 管道

管道用于组合多条命令，让上一条命令的输出作为下一条命令的输入

> [!example] 统计登录条数
> 
> `who` 用于检查有哪些账户在什么时候登录系统，`wc` 用于统计文本行数。通过 `|` 将 `who` 的结果传递给 `wc` 自动统计登录条数
> 
> ![[../../../../_resources/images/Pasted image 20241120102021.png]]
# 重定向

使用 `>` 或 `>>` 重定向输出流，`<` 重定向输入流，常用于导入导出文本内容
- `>` 会覆盖输出文件，`>>` 则会追加内容
- `<` 用于输入一个文件内容，`<<` 则用于输入一段话。开头结尾使用 `<TAG>` 匹配
	- `<<-` 可忽略每行前的 <kbd>Tab</kbd>

```shell
<< <TAG>
...
<TAG>
```

标准输入流即控制台记为 `0`，标准输出流为 `1`，标准错误输出为 `2`

![[../../../../_resources/images/Pasted image 20241120103613.png]]

- 对 `0` 和 `1` 的重定向可省略

> [!example] `echo 1>test.txt` 与 `echo >test.txt` 等价

- 使用 `&>` 和 `&>>` 可以同时将标准输出流和标准错误流重定向

> [!example] `ls -l /etc/hosts /nofile &>test.txt`

- 使用 `&0`、` &1 `、` &2 ` 引用标准流（在重定向标记右侧使用）

> [!example] 将错误流重定向到输出流：`2>&1`

- 特殊设备 `/dev/null`，重定向于此可用于销毁所有输出
# 引号

- `""`：内部值为一个整体而不是多个参数

> [!example]
> 删除 `a`，`b`，`c` 三个文件
> ```shell
> rm -rf a b c
> ```
> 
> 删除名为 `a b c` 的文件
> ```shell
> rm -rf "a b c"
> ```

- `''`：等同于 `""`，但可以将特殊符号作为普通符号使用，如 `#`，`$`，`*`，`&`，`~`，`()` 等

- \`\`：执行内部的指令，并将输出作为结果替代

> [!example] 打包备份 log 文件到 `log-日期.tar.gz`
> ```shell
> tar -czf ~/log-`date +%Y%m%d`.tar.gz  /var/log/
> ```
# 变量

变量合法命名包括字母、数字、下划线，且不以下划线开头
- 使用 `<name>=<value>` 创建变量，注意 `=` 两边不能有空格
- 使用 `$<name>` 或 `${<name>}` 引用变量
- 使用 `unset <name>` 删除变量

> [!example] 变量使用
> 创建变量 test=123
> ```shell
> test=123
> ```
> 使用变量
> ```shell
> # 123
> echo $test
> ```
> 若变量后面直接连接字符串，为避免歧义可使用 ${}
> ```shell
> # 123RMB
> echo ${test}RMB
> ```
> 但如果有 ` `，`-`，`:` 等分隔不需要
> ```shell
> # 123 RMB
> echo $test RMB
> # 123-RMB
> echo $test-RMB
> ```
> 变量可以在 `""` 中使用，但不能在 `''` 中使用
> ```shell
> # 123 RMB
> echo "$test RMB"
> # $test RMB
> echo '$test RMB'
> ```
> 删除变量
> ```shell
> unset test
> ```

`$` 还可以引用系统预设变量

| 变量名        | 描述                                         |
| ---------- | ------------------------------------------ |
| `UID`      | 当前账户的账户ID号                                 |
| `USER`     | 当前账户的账户名称                                  |
| `HISTSIZE` | 当前终端的最大历史命令条目数量(最多可以记录多少条历史命令)             |
| `HOME`     | 当前账户的根目录                                   |
| `LANG`     | 当前环境使用的语言                                  |
| `PATH`     | 命令搜索路径                                     |
| `PWD`      | 返回当前工作目录                                   |
| `RANDOM`   | 随机返回0至32767的整数                             |
| `$0`       | 返回当前命令的名称                                  |
| `$n`       | 返回位置参数,如 `$1` 为(第一个位置参数)，数字大于 9 时必须使用 ${n} |
| `$#`       | 命令参数的个数                                    |
| `$*`       | 命令行的所有参数，`$*` 所有的参数作为一个整体                  |
| `$@`       | 命令行的所有参数，`$@` 所有的参数作为独立的个体                 |
| `$?`       | 返回上一条命令退出时的状态代码，通常 0 代表正确                  |
| `$$`       | 返回当前进程的进程号                                 |
| `$!`       | 返回最后一个后台进程的进程号                             |
| `!!`       | 上一条命令                                      |
| `$_`       | 上一条指令的最后一个参数                               |
# 数据过滤与正则

![[grep]]
# 算术运算

- 使用 `$((表达式))`，`$[表达式]`，`let 变量=表达式` 进行整数运算

| 运算符号        | 含义描述            |
| ----------- | --------------- |
| ++          | 自加1             |
| --          | 自减1             |
| +           | 加法              |
| -           | 减法              |
| *           | 乘法              |
| /           | 除法              |
| **          | 求幂              |
| %           | 取余(求模)          |
| +=          | 自加任意数           |
| -=          | 自减任意数           |
| *=          | 自乘任意数           |
| /=          | 自除任意数           |
| %=          | 对任意数取余          |
| &&          | 逻辑与             |
| \|          | 逻辑或             |
| >           | 大于              |
| >=          | 大于或等于           |
| <           | 小于              |
| <=          | 小于或等于           |
| 表达式?表达式:表达式 | 根据表达式的结果,返回特定的值 |

- 使用 `bc` 命令进行浮点数运算，该计算器可进行任何算术运算

![[bc]]